[[cse]][#top]##

[width="100%",cols="<50%,>50%",]
|===
|*Developing Persistence Architectures Using EclipseLink Database Web
Services* +
*Release 4.0* + a|
[width="99%",cols="20%,^16%,16%,^16%,16%,^16%",]
|===
|  |image:../../dcommon/images/contents.png[Go To Table Of
Contents,width=16,height=16] + | 
|link:../../[image:../../dcommon/images/search.png[Search] +
[.mini]##] | 
|link:../eclipselink_moxy.pdf[image:../../dcommon/images/pdf_icon.png[PDF]]
|===

|===

'''''

[cols="^,^,",]
|===
|link:creating_dbws_services006.htm[image:../../dcommon/images/larrow.png[Previous,width=16,height=16]]
|link:creating_dbws_services008.htm[image:../../dcommon/images/rarrow.png[Next,width=16,height=16]]
| 
|===

[#TLDBW179]##

[#sthref55]##

== Creating from a Stored Procedure with complex PL/SQL arguments

With EclipseLink, you can create a DBWS web service from a stored
procedure that uses complex PL/SQL types as either an `IN`, `OUT`, or
`IN` `OUT` argument.

[#TLDBW180]##

[#sthref56]##

=== Example

In this example, the following stored procedure is used:

[source,oac_no_warn]
----
PROCEDURE P1(OLDREC IN ARECORD, FOO IN VARCHAR2, AREC OUT ARECORD) IS  BEGIN    AREC.T1 := ... some processing based upon OLDREC    AREC.T2 := ... AND FOO    AREC.T3 := ...  END P1;
 
----

Type `ARECORD` is defined in the PL/SQL package `SOMEPACKAGE` as
follows:

[source,oac_no_warn]
----
CREATE OR REPLACE PACKAGE SOMEPACKAGE AS
  TYPE TBL1 IS TABLE OF VARCHAR2(111) INDEX BY BINARY_INTEGER;
  TYPE TBL2 IS TABLE OF NUMBER INDEX BY BINARY_INTEGER;
  TYPE ARECORD IS RECORD (
    T1 TBL1,
    T2 TBL2,
    T3 BOOLEAN
  );
  PROCEDURE P1(OLDREC IN ARECORD, FOO IN VARCHAR2, AREC OUT ARECORD);
END SOMEPACKAGE;
----

Because PL/SQL record and collection types cannot be transported via
JDBC, EclipseLink will generate an anonymous block of PL/SQL code that
contains the functions to convert to and from JDBC and PL/SQl types. To
be successful, each PL/SQL type or collection type that will appear in
an `IN`, `IN OUT`, or `OUT OF RETURN` argument (or any PL/SQL record or
collection type that is nested within these arguments) _must_ have an
equivalent JDBC type. The name of this type must be in the form
`<package name>_<type name>`.

For this example, the following JDBC types are required:

[source,oac_no_warn]
----
CREATE OR REPLACE TYPE SOMEPACKAGE_TBL1 AS TABLE OF VARCHAR2(111)
 
CREATE OR REPLACE TYPE SOMEPACKAGE_TBL2 AS TABLE OF NUMBER
 
CREATE OR REPLACE TYPE SOMEPACKAGE_ARECORD AS OBJECT (
  T1 SOMEPACKAGE_TBL1,
  T2 SOMEPACKAGE_TBL2,
  T3 BOOLEAN
)
----

The DBWSBuilder utility requires a DBWS configuration file as input.

[source,oac_no_warn]
----
<?xml version="1.0" encoding="UTF-8"?>
<dbws-builder xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <properties>
    <property name="projectName">testPLSQLProcedure</property>
    ... database properties
  </properties>
  <plsql-procedure
    name="plsqlprocedure"
    catalogPattern="SOMEPACKAGE"
    procedurePattern="P1"
  />
</dbws-builder>
----

Notice that `returnType` is set to `SOMEPACKAGE_ARECORD`. This value
indicates a complex type in the generated EclipseLink DBWS schema (as
shown below). In this case, it is constructed based on the contents of
the `SOMEPACKAGE` package.

Execute the `DBWSBuilder`, as shown here:

[source,oac_no_warn]
----
prompt > dbwsbuilder.cmd -builderFile dbws-builder.xml -stageDir output_directory -packageAs wls testPLSQLProcedure.war
----

where

* `dbws-builder.xml` is the DBWS builder configuration file (as shown
previously).
* `output_directory` is the output directory for the generated files.
* `-packageAs` is the platform on which the web service will be
deployed.

The generated `eclipselink-dbws-schema.xsd` file follows:

[source,oac_no_warn]
----
<?xml version="1.0" encoding="UTF-8"?>
<xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema" targetNamespace="urn:plsqlprocedure" xmlns="urn:plsqlprocedure" elementFormDefault="qualified">
   <xsd:complexType name="SOMEPACKAGE_TBL1">
      <xsd:sequence>
         <xsd:element name="item" type="xsd:string" maxOccurs="unbounded" nillable="true"/>
      </xsd:sequence>
   </xsd:complexType>
   <xsd:complexType name="SOMEPACKAGE_TBL2">
      <xsd:sequence>
         <xsd:element name="item" type="xsd:decimal" maxOccurs="unbounded" nillable="true"/>
      </xsd:sequence>
   </xsd:complexType>
   <xsd:complexType name="SOMEPACKAGE_ARECORD">
      <xsd:sequence>
         <xsd:element name="t1">
            <xsd:complexType>
               <xsd:sequence>
                  <xsd:element name="item" type="xsd:string" maxOccurs="unbounded" nillable="true"/>
               </xsd:sequence>
            </xsd:complexType>
         </xsd:element>
         <xsd:element name="t2">
            <xsd:complexType>
               <xsd:sequence>
                  <xsd:element name="item" type="xsd:decimal" maxOccurs="unbounded" nillable="true"/>
               </xsd:sequence>
            </xsd:complexType>
         </xsd:element>
         <xsd:element name="t3" type="xsd:boolean" nillable="true"/>
      </xsd:sequence>
   </xsd:complexType>
   <xsd:complexType name="simple-xml-format">
      <xsd:sequence>
         <xsd:any minOccurs="0"/>
      </xsd:sequence>
   </xsd:complexType>
   <xsd:element name="SOMEPACKAGE_TBL1" type="SOMEPACKAGE_TBL1"/>
   <xsd:element name="SOMEPACKAGE_TBL2" type="SOMEPACKAGE_TBL2"/>
   <xsd:element name="SOMEPACKAGE_ARECORD" type="SOMEPACKAGE_ARECORD"/>
</xsd:schema>
----

'''''

[width="66%",cols="50%,^,>50%",]
|===
a|
[width="96%",cols=",^50%,^50%",]
|===
| 
|link:creating_dbws_services006.htm[image:../../dcommon/images/larrow.png[Previous,width=16,height=16]]
|link:creating_dbws_services008.htm[image:../../dcommon/images/rarrow.png[Next,width=16,height=16]]
|===

|http://www.eclipse.org/eclipselink/[image:../../dcommon/images/ellogo.png[EclipseLink,width=150]] +
a|
[width="99%",cols="20%,^16%,16%,^16%,16%,^16%",]
|===
|  |image:../../dcommon/images/contents.png[Go To Table Of
Contents,width=16,height=16] + | 
|link:../../[image:../../dcommon/images/search.png[Search] +
[.mini]##] | 
|link:../eclipselink_moxy.pdf[image:../../dcommon/images/pdf_icon.png[PDF]]
|===

|===

[[copyright]]
Copyright © 2014 by The Eclipse Foundation under the
http://www.eclipse.org/org/documents/epl-v10.php[Eclipse Public License
(EPL)] +
