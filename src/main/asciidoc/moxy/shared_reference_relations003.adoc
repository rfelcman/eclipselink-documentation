[[cse]][#top]##

[width="100%",cols="<50%,>50%",]
|===
a|
Developing JAXB Applications Using EclipseLink MOXy, *Release 4.0* +

a|
[width="99%",cols="20%,^16%,16%,^16%,16%,^16%",]
|===
|  |image:../../dcommon/images/contents.png[Go To Table Of
Contents,width=16,height=16] + | 
|link:../../[image:../../dcommon/images/search.png[Search] +
[.mini]##] | 
|link:../eclipselink_moxy.pdf[image:../../dcommon/images/pdf_icon.png[PDF]]
|===

|===

'''''

[cols="^,^,",]
|===
|link:shared_reference_relations002.htm[image:../../dcommon/images/larrow.png[Previous,width=16,height=16]]
|link:shared_reference_relations004.htm[image:../../dcommon/images/rarrow.png[Next,width=16,height=16]]
| 
|===

[#TLJAX350]##

[#sthref132]##

== Using the Embedded Key Class

With JAXB, you can derive an XML representation from a set of JPA
entities, when a JPA entity has an embedded ID class.

In link:#BABIJHJI[Example 7-4], the `EmployeeId` is the embedded ID of
the *Employee* class:

[#BABIJHJI]####[#TLJAX351]####

*_Example 7-4 Sample Embedded ID_*

[source,oac_no_warn]
----
@Entity
public class PhoneNumber {
 
    @ManyToOne
    @JoinColumns({
        @JoinColumn(name="E_ID", referencedColumnName = "E_ID"),
        @JoinColumn(name="E_COUNTRY", referencedColumnName = "COUNTRY")
    })
    private Employee contact;
 
}
 
@Entity
@IdClass(EmployeeId.class)
public class Employee {
 
    @EmbeddedId
    private EmployeeId id;
 
    @OneToMany(mappedBy="contact")
    private List<PhoneNumber> contactNumber;
 
}
 
@Embeddable
public class EmployeeId {
 
    @Column(name="E_ID")
    private BigDecimal eId;
 
    private String country;
 
}
 
----

For the JAXB bindings, the XML accessor type will be set to *FIELD* for
all the model classes. This can be set as a package level JAXB
annotation, as shown here:

[source,oac_no_warn]
----
@XmlAccessorType(XmlAccessType.FIELD)
package com.example.model;
 
import jakarta.xml.bind.annotation.XmlAccessType;
import jakarta.xml.bind.annotation.XmlAccessorType;
 
----

link:#BABHCDEJ[Example 7-5] uses the EclipseLink extension
`@XmlCustomizer` which extends the JAXB specification. Because the
contact attribute is a bidirectional relationship, it includes the
EclipseLink extension `@XmlInverseReference`.

[#BABHCDEJ]####[#TLJAX352]####

*_Example 7-5 Using the @XmlCustomizer Annotation_*

[source,oac_no_warn]
----
@Entity
@IdClass(EmployeeId.class)
@XmlCustomizer(EmployeeCustomizer.class)
public class Employee {
 
    @EmbeddedId
    private EmployeeId id;
 
    @OneToMany(mappedBy="contact")
    @XmlInverseReference(mappedBy="contact")
    private List<PhoneNumber> contactNumber;
 
}
 
----

To embed the content of the *EmployeeId* class in the complex type
corresponding to the *Employee* class, change the XPath on the mapping
for the `id` property to be _self_ or** . **. Then specify the XPath to
the XML nodes which represent the ID.

[#TLJAX353]####[#sthref133]####

*_Example 7-6 Changing the XPath_*

[source,oac_no_warn]
----
import org.eclipse.persistence.config.DescriptorCustomizer;
import org.eclipse.persistence.descriptors.ClassDescriptor;
import org.eclipse.persistence.oxm.mappings.XMLCompositeObjectMapping;
 
public class EmployeeCustomizer implements DescriptorCustomizer {
 
    public void customize(ClassDescriptor descriptor) throws Exception {
        XMLCompositeObjectMapping idMapping = 
            (XMLCompositeObjectMapping) descriptor.getMappingForAttributeName("id");
        idMapping.setXPath(".");
 
        descriptor.addPrimaryKeyFieldName("eId/text()");
        descriptor.addPrimaryKeyFieldName("country/text()");
    }
 
}
 
----

If the target object had a single ID then we would use `@XmlIDREF`.
Since the target object has a compound key, we will mark the field
`@XmlTransient`, and use the EclipseLink extension `@XmlCustomizer` to
set up the mapping.

[#TLJAX354]####[#sthref134]####

*_Example 7-7 Using the @XmlTransient Annotation_*

[source,oac_no_warn]
----
@Entity
@XmlCustomizer(PhoneNumberCustomizer.class)
public class PhoneNumber {
 
    @ManyToOne
    @JoinColumns({
        @JoinColumn(name="E_ID", referencedColumnName = "E_ID"),
        @JoinColumn(name="E_COUNTRY", referencedColumnName = "COUNTRY")
    })
    @XmlTransient
    private Employee contact;
 
}
 
----

An `XMLObjectReferenceMapping` will be created. The mapping will include
multiple key mappings.

[source,oac_no_warn]
----
import org.eclipse.persistence.config.DescriptorCustomizer;
import org.eclipse.persistence.descriptors.ClassDescriptor;
import org.eclipse.persistence.oxm.mappings.XMLObjectReferenceMapping;
 
public class PhoneNumberCustomizer implements DescriptorCustomizer {
 
    public void customize(ClassDescriptor descriptor) throws Exception {
        XMLObjectReferenceMapping contactMapping = new XMLObjectReferenceMapping();
        contactMapping.setAttributeName("contact");
        contactMapping.setReferenceClass(Employee.class);
        contactMapping.addSourceToTargetKeyFieldAssociation("contact/@eID", "eId/text()");
        contactMapping.addSourceToTargetKeyFieldAssociation("contact/@country", "country/text()");
        descriptor.addMapping(contactMapping);
    }
 
}
----

'''''

[width="66%",cols="50%,^,>50%",]
|===
a|
[width="96%",cols=",^50%,^50%",]
|===
| 
|link:shared_reference_relations002.htm[image:../../dcommon/images/larrow.png[Previous,width=16,height=16]]
|link:shared_reference_relations004.htm[image:../../dcommon/images/rarrow.png[Next,width=16,height=16]]
|===

|http://www.eclipse.org/eclipselink/[image:../../dcommon/images/ellogo.png[EclipseLink,width=150]] +
a|
[width="99%",cols="20%,^16%,16%,^16%,16%,^16%",]
|===
|  |image:../../dcommon/images/contents.png[Go To Table Of
Contents,width=16,height=16] + | 
|link:../../[image:../../dcommon/images/search.png[Search] +
[.mini]##] | 
|link:../eclipselink_moxy.pdf[image:../../dcommon/images/pdf_icon.png[PDF]]
|===

|===

[[copyright]]
Copyright © 2013 by The Eclipse Foundation under the
http://www.eclipse.org/org/documents/epl-v10.php[Eclipse Public License
(EPL)] +
