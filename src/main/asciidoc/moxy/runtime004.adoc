[[cse]][#top]##

[width="100%",cols="<50%,>50%",]
|===
a|
Developing JAXB Applications Using EclipseLink MOXy, *Release 4.0* +

a|
[width="99%",cols="20%,^16%,16%,^16%,16%,^16%",]
|===
|  |image:../../dcommon/images/contents.png[Go To Table Of
Contents,width=16,height=16] + | 
|link:../../[image:../../dcommon/images/search.png[Search] +
[.mini]##] | 
|link:../eclipselink_moxy.pdf[image:../../dcommon/images/pdf_icon.png[PDF]]
|===

|===

'''''

[cols="^,^,",]
|===
|link:runtime003.htm[image:../../dcommon/images/larrow.png[Previous,width=16,height=16]]
|link:runtime005.htm[image:../../dcommon/images/rarrow.png[Next,width=16,height=16]]
| 
|===

[#CACDDJHJ]####[#TLJAX156]####

== Using MetadataSource

The `MetadataSource`, introduced in EclipseLink 2.3, is responsible for
serving up EclipseLink metadata. This allows you to store mapping
information outside of your application and have it retrieved when the
application's `JAXBContext` is being created or refreshed.

[#TLJAX157]##

[#sthref34]##

=== Implementing a MetadataSource

To implement your own `MetadataSource`, you can:

* Create a new class that implements the
`org.eclipse.persistence.jaxb.metadata.MetadataSource interface`.
* Create a new class that extends the
`org.eclipse.persistence.jaxb.metadata.MetadataSourceAdapter` class.
Using this method is preferred, as it will insulate you from future
additions to the interface.

In either case, you will be responsible for implementing the following
method:

[#TLJAX158]####[#sthref35]####

*_Example 2-20 Implementing the XMlBindings Method_*

[source,oac_no_warn]
----
/**
 * Retrieve XmlBindings according to the JAXBContext bootstrapping information.
 *
 * @param properties - The properties passed in to create the JAXBContext
 * @param classLoader - The ClassLoader passed in to create the JAXBContext
 * @return the XmlBindings object representing the metadata
 */
XmlBindings getXmlBindings(Map<String, ?> properties, ClassLoader classLoader);
----

[#TLJAX159]##

[#sthref36]##

=== Using an XmlBindings Object

Internally, EclipseLink metadata is stored in an `XmlBindings` object,
which itself is mapped with JAXB. This means that you can actually use a
JAXB unmarshaller to read external metadata and create an `XmlBindings`
from it:

[#TLJAX160]####[#sthref37]####

*_Example 2-21 Sample XmlBindings Object_*

[source,oac_no_warn]
----
package example;
 
import org.eclipse.persistence.jaxb.xmlmodel.XmlBindings;
...
JAXBContext xmlBindingsContext = JAXBContext.newInstance("org.eclipse.persistence.jaxb.xmlmodel");
FileReader bindingsFile = new FileReader("xml-bindings.xml");
XmlBindings bindings = (XmlBindings) xmlBindingsContext.createUnmarshaller().unmarshal(bindingsFile);
----

[#TLJAX161]##

[#sthref38]##

=== Specifying the MetadataSource

To use a `MetadataSource` in creating a `JAXBContext`, add it to the
properties map with the key `JAXBContextProperties.OXM_METADATA_SOURCE`:

[#TLJAX162]####[#sthref39]####

*_Example 2-22 Adding MetadataSource to the Properties Map_*

[source,oac_no_warn]
----
MetadataSource metadataSource = new MyMetadataSource();
 
Map<String, Object> properties = new HashMap<String, Object>(1);
properties.put(JAXBContextProperties.OXM_METADATA_SOURCE, metadataSource);
 
JAXBContext jc = JAXBContext.newInstance(new Class[] { Customer.class }, properties);
----

[#TLJAX163]##

[#sthref40]##

=== MetadataSource Example

The following example creates an `XmlBindings` object by unmarshalling
from a URL:

[#TLJAX164]####[#sthref41]####

*_Example 2-23 Sample XmlBindings Object_*

[source,oac_no_warn]
----
package example;
 
import java.net.URL;
import java.util.Map;
 
import jakarta.xml.bind.JAXBContext;
 
import org.eclipse.persistence.jaxb.metadata.MetadataSourceAdapter;
import org.eclipse.persistence.jaxb.xmlmodel.XmlBindings;
 
public class MyMetadataSource extends MetadataSourceAdapter {
 
   private JAXBContext bindingsContext;
   private URL bindingsUrl;
 
   private final String XML_BINDINGS_PACKAGE = "org.eclipse.persistence.jaxb.xmlmodel";
   private final String METADATA_URL = "http://www.example.com/private/metadata/xml-bindings.xml"; 
   public MyMetadataSource() {
      try {
         bindingsContext = JAXBContext.newInstance(XML_BINDINGS_PACKAGE);
         bindingsUrl = new URL(METADATA_URL);
      } catch (Exception e) {
         throw new RuntimeException(e);
      }
   }
 
   @Override
   public XmlBindings getXmlBindings(Map<String, ?> properties, ClassLoader classLoader) {
      try {
         Unmarshaller u = bindingsContext.createUnmarshaller();
         XmlBindings bindings = (XmlBindings) u.unmarshal(bindingsUrl);
         return bindings;
      } catch (Exception e) {
         throw new RuntimeException(e);
      }
   }
 
}
----

[#TLJAX165]##

[#sthref42]##

=== Building XmlBindings Programatically

You also have the option of building your own `XmlBindings` object from
scratch in code. The example below modifies the `pCode` field of the
*Address* class to use a locale-specific name:

[#TLJAX166]####[#sthref43]####

*_Example 2-24 Sample XmlBindings Object_*

[source,oac_no_warn]
----
package example;
 
import java.util.Locale;
import java.util.Map;
 
import org.eclipse.persistence.jaxb.metadata.MetadataSourceAdapter;
import org.eclipse.persistence.jaxb.xmlmodel.JavaType;
import org.eclipse.persistence.jaxb.xmlmodel.JavaType.JavaAttributes;
import org.eclipse.persistence.jaxb.xmlmodel.ObjectFactory;
import org.eclipse.persistence.jaxb.xmlmodel.XmlBindings;
import org.eclipse.persistence.jaxb.xmlmodel.XmlBindings.JavaTypes;
import org.eclipse.persistence.jaxb.xmlmodel.XmlElement;
 
public class AddressMetadataSource extends MetadataSourceAdapter {
 
    private ObjectFactory factory;
    private XmlBindings xmlBindings;
 
    public AddressMetadataSource() {
        factory = new ObjectFactory();
 
        xmlBindings = new XmlBindings();
        xmlBindings.setPackageName("example");
        xmlBindings.setJavaTypes(new JavaTypes());
    }
 
    @Override
    public XmlBindings getXmlBindings(Map<String, ?> properties, ClassLoader classLoader) {
        JavaType javaType = new JavaType();
        javaType.setName("Address");
        javaType.setJavaAttributes(new JavaAttributes());
 
        XmlElement pCodeElement = new XmlElement();
        pCodeElement.setJavaAttribute("pCode");
 
        String country = Locale.getDefault().getCountry(); 
        if (country.equals(Locale.US.getCountry())) {
            pCodeElement.setName("zip-code");
        } else if (country.equals(Locale.UK.getCountry())) {
            pCodeElement.setName("post-code");
        } else if (country.equals(Locale.CANADA.getCountry())) {
            pCodeElement.setName("postal-code");
        }
 
        javaType.getJavaAttributes().getJavaAttribute().add(factory.createXmlElement(pCodeElement));
 
        xmlBindings.getJavaTypes().getJavaType().add(javaType);
        return xmlBindings;
    }
 
}
----

'''''

[width="66%",cols="50%,^,>50%",]
|===
a|
[width="96%",cols=",^50%,^50%",]
|===
| 
|link:runtime003.htm[image:../../dcommon/images/larrow.png[Previous,width=16,height=16]]
|link:runtime005.htm[image:../../dcommon/images/rarrow.png[Next,width=16,height=16]]
|===

|http://www.eclipse.org/eclipselink/[image:../../dcommon/images/ellogo.png[EclipseLink,width=150]] +
a|
[width="99%",cols="20%,^16%,16%,^16%,16%,^16%",]
|===
|  |image:../../dcommon/images/contents.png[Go To Table Of
Contents,width=16,height=16] + | 
|link:../../[image:../../dcommon/images/search.png[Search] +
[.mini]##] | 
|link:../eclipselink_moxy.pdf[image:../../dcommon/images/pdf_icon.png[PDF]]
|===

|===

[[copyright]]
Copyright © 2013 by The Eclipse Foundation under the
http://www.eclipse.org/org/documents/epl-v10.php[Eclipse Public License
(EPL)] +
